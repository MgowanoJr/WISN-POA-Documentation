<!doctype html>
<html class="no-js" lang="">
    <head>
        <meta charset="utf-8">
        <meta http-equiv="x-ua-compatible" content="ie=edge">
        <title>wisn-poa documentation</title>
        <meta name="description" content="">
        <meta name="viewport" content="width=device-width, initial-scale=1">

        <link rel="icon" type="image/x-icon" href="../images/favicon.ico">
	      <link rel="stylesheet" href="../styles/style.css">
    </head>
    <body>

        <div class="navbar navbar-default navbar-fixed-top visible-xs">
            <a href="../" class="navbar-brand">wisn-poa documentation</a>
            <button type="button" class="btn btn-default btn-menu ion-ios-menu" id="btn-menu"></button>
        </div>

        <div class="xs-menu menu" id="mobile-menu">
                <div id="book-search-input" role="search"><input type="text" placeholder="Type to search"></div>            <compodoc-menu></compodoc-menu>
        </div>

        <div class="container-fluid main">
           <div class="row main">
               <div class="hidden-xs menu">
                   <compodoc-menu mode="normal"></compodoc-menu>
               </div>
               <!-- START CONTENT -->
               <div class="content injectable">
                   <div class="content-data">







<ol class="breadcrumb">
  <li>Injectables</li>
  <li>PoaCostAssumptionEffect</li>
</ol>

<ul class="nav nav-tabs" role="tablist">
        <li class="active">
            <a href="#info" role="tab" id="info-tab" data-toggle="tab" data-link="info">Info</a>
        </li>
        <li >
            <a href="#source" role="tab" id="source-tab" data-toggle="tab" data-link="source">Source</a>
        </li>
</ul>

<div class="tab-content">
    <div class="tab-pane fade active in" id="c-info">
        <p class="comment">
            <h3>File</h3>
        </p>
        <p class="comment">
            <code>src/app/store/effects/poa-cost-assumption.effect.ts</code>
        </p>




            <section>
    <h3 id="index">Index</h3>
    <table class="table table-sm table-bordered index-table">
        <tbody>
                <tr>
                    <td class="col-md-4">
                        <h6><b>Properties</b></h6>
                    </td>
                </tr>
                <tr>
                    <td class="col-md-4">
                        <ul class="index-list">
                            <li>
                                <a href="#allowanceCostData">allowanceCostData</a>
                            </li>
                            <li>
                                <a href="#allowanceCostDataElements">allowanceCostDataElements</a>
                            </li>
                            <li>
                                <a href="#analyticsDxCollection">analyticsDxCollection</a>
                            </li>
                            <li>
                                <a href="#cadreFromGeneralConfig">cadreFromGeneralConfig</a>
                            </li>
                            <li>
                                <a href="#checkingPoaSurplusState">checkingPoaSurplusState</a>
                            </li>
                            <li>
                                <a href="#costAssumptionProgram">costAssumptionProgram</a>
                            </li>
                            <li>
                                <a href="#costAssumptionProgramEventDataValues">costAssumptionProgramEventDataValues</a>
                            </li>
                            <li>
                                <a href="#costAssumptionsPageDetails">costAssumptionsPageDetails</a>
                            </li>
                            <li>
                                <a href="#currentDomElementFieldUpdated">currentDomElementFieldUpdated</a>
                            </li>
                            <li>
                                <a href="#currentUser">currentUser</a>
                            </li>
                            <li>
                                <a href="#dataElements">dataElements</a>
                            </li>
                            <li>
                                <a href="#eventData">eventData</a>
                            </li>
                            <li>
                                <a href="#lastUpdated">lastUpdated</a>
                            </li>
                            <li>
                                <a href="#loadCostAssumptions$">loadCostAssumptions$</a>
                            </li>
                            <li>
                                <a href="#loadMaxHRHfromPRI">loadMaxHRHfromPRI</a>
                            </li>
                            <li>
                                <a href="#maxBudgetHRHconstraintData">maxBudgetHRHconstraintData</a>
                            </li>
                            <li>
                                <a href="#maxBudgetHRHconstraintDataElements">maxBudgetHRHconstraintDataElements</a>
                            </li>
                            <li>
                                <a href="#maxNumberHRHconstraintData">maxNumberHRHconstraintData</a>
                            </li>
                            <li>
                                <a href="#maxNumberHRHconstraintDataElements">maxNumberHRHconstraintDataElements</a>
                            </li>
                            <li>
                                <a href="#monthlySalaryData">monthlySalaryData</a>
                            </li>
                            <li>
                                <a href="#monthlySalaryDataElements">monthlySalaryDataElements</a>
                            </li>
                            <li>
                                <a href="#period">period</a>
                            </li>
                            <li>
                                <a href="#redistributionCostData">redistributionCostData</a>
                            </li>
                            <li>
                                <a href="#redistributionCostDataElements">redistributionCostDataElements</a>
                            </li>
                            <li>
                                <a href="#selectedOrgunit">selectedOrgunit</a>
                            </li>
                            <li>
                                <a href="#singleEventUpload">singleEventUpload</a>
                            </li>
                            <li>
                                <a href="#subPageId">subPageId</a>
                            </li>
                            <li>
                                <a href="#todayTimeDate">todayTimeDate</a>
                            </li>
                            <li>
                                <a href="#updatingCostAssumptionProgramValues$">updatingCostAssumptionProgramValues$</a>
                            </li>
                        </ul>
                    </td>
                </tr>






        </tbody>
    </table>
</section>

            <section>
    <h3 id="constructor">Constructor</h3>
        <table class="table table-sm table-bordered">
            <tbody>
                <tr>
                    <td class="col-md-4">
<code>constructor(action$: <a href="../undefineds/Actions.html">Actions</a>, poaAnalyticsService: <a href="../injectables/PoaAnalyticsService.html">PoaAnalyticsService</a>, wisnAnalyticsService: <a href="../injectables/WisnAnalyticsService.html">WisnAnalyticsService</a>, wisnPoaService: <a href="../injectables/WisnPoaPageService.html">WisnPoaPageService</a>, store: Store<AppState>)</code>
                    </td>
                </tr>
                        <tr>
                            <td class="col-md-4">
                                <div class="io-line">Defined in <a href="" data-line="72" class="link-to-prism">src/app/store/effects/poa-cost-assumption.effect.ts:72</a></div>
                            </td>
                        </tr>

                <tr>
                    <td class="col-md-4">
                            <div>
                                    <b>Parameters :</b>
                                    <table class="params">
                                        <thead>
                                            <tr>
                                                <td>Name</td>
                                                    <td>Type</td>
                                                <td>Optional</td>
                                            </tr>
                                        </thead>
                                        <tbody>
                                                <tr>
                                                        <td>action$</td>
                                                  
                                                        <td>
                                                                        <code><a href="../miscellaneous/typealiases.html#Actions" target="_self" >Actions</a></code>
                                                        </td>
                                                  
                                                    <td>
                                                            No
                                                    </td>
                                                    
                                                </tr>
                                                <tr>
                                                        <td>poaAnalyticsService</td>
                                                  
                                                        <td>
                                                                        <code><a href="../injectables/PoaAnalyticsService.html" target="_self" >PoaAnalyticsService</a></code>
                                                        </td>
                                                  
                                                    <td>
                                                            No
                                                    </td>
                                                    
                                                </tr>
                                                <tr>
                                                        <td>wisnAnalyticsService</td>
                                                  
                                                        <td>
                                                                        <code><a href="../injectables/WisnAnalyticsService.html" target="_self" >WisnAnalyticsService</a></code>
                                                        </td>
                                                  
                                                    <td>
                                                            No
                                                    </td>
                                                    
                                                </tr>
                                                <tr>
                                                        <td>wisnPoaService</td>
                                                  
                                                        <td>
                                                                        <code><a href="../injectables/WisnPoaPageService.html" target="_self" >WisnPoaPageService</a></code>
                                                        </td>
                                                  
                                                    <td>
                                                            No
                                                    </td>
                                                    
                                                </tr>
                                                <tr>
                                                        <td>store</td>
                                                  
                                                        <td>
                                                                    <code>Store&lt;AppState&gt;</code>
                                                        </td>
                                                  
                                                    <td>
                                                            No
                                                    </td>
                                                    
                                                </tr>
                                        </tbody>
                                    </table>
                            </div>
                    </td>
                </tr>
            </tbody>
        </table>
</section>


            <section>
    
        <h3 id="inputs">
            Properties
        </h3>
        <table class="table table-sm table-bordered">
            <tbody>
                <tr>
                    <td class="col-md-4">
                        <a name="allowanceCostData"></a>
                        <span class="name">
                            <b>
                            allowanceCostData</b>
                            <a href="#allowanceCostData"><span class="icon ion-ios-link"></span></a>
                        </span>
                    </td>
                </tr>
                    <tr>
                        <td class="col-md-4">
                            <i>Type : </i>    <code>any[]</code>

                        </td>
                    </tr>
                        <tr>
                            <td class="col-md-4">
                                    <div class="io-line">Defined in <a href="" data-line="57" class="link-to-prism">src/app/store/effects/poa-cost-assumption.effect.ts:57</a></div>
                            </td>
                        </tr>


            </tbody>
        </table>
        <table class="table table-sm table-bordered">
            <tbody>
                <tr>
                    <td class="col-md-4">
                        <a name="allowanceCostDataElements"></a>
                        <span class="name">
                            <b>
                            allowanceCostDataElements</b>
                            <a href="#allowanceCostDataElements"><span class="icon ion-ios-link"></span></a>
                        </span>
                    </td>
                </tr>
                    <tr>
                        <td class="col-md-4">
                            <i>Type : </i>        <code><a href="https://www.typescriptlang.org/docs/handbook/basic-types.html" target="_blank" >any</a></code>

                        </td>
                    </tr>
                        <tr>
                            <td class="col-md-4">
                                    <div class="io-line">Defined in <a href="" data-line="48" class="link-to-prism">src/app/store/effects/poa-cost-assumption.effect.ts:48</a></div>
                            </td>
                        </tr>


            </tbody>
        </table>
        <table class="table table-sm table-bordered">
            <tbody>
                <tr>
                    <td class="col-md-4">
                        <a name="analyticsDxCollection"></a>
                        <span class="name">
                            <b>
                            analyticsDxCollection</b>
                            <a href="#analyticsDxCollection"><span class="icon ion-ios-link"></span></a>
                        </span>
                    </td>
                </tr>
                    <tr>
                        <td class="col-md-4">
                            <i>Type : </i>        <code><a href="https://developer.mozilla.org/en-US/docs/Web/JavaScript/Reference/Global_Objects/string" target="_blank" >string</a></code>

                        </td>
                    </tr>
                        <tr>
                            <td class="col-md-4">
                                    <div class="io-line">Defined in <a href="" data-line="52" class="link-to-prism">src/app/store/effects/poa-cost-assumption.effect.ts:52</a></div>
                            </td>
                        </tr>


            </tbody>
        </table>
        <table class="table table-sm table-bordered">
            <tbody>
                <tr>
                    <td class="col-md-4">
                        <a name="cadreFromGeneralConfig"></a>
                        <span class="name">
                            <b>
                            cadreFromGeneralConfig</b>
                            <a href="#cadreFromGeneralConfig"><span class="icon ion-ios-link"></span></a>
                        </span>
                    </td>
                </tr>
                    <tr>
                        <td class="col-md-4">
                            <i>Type : </i>        <code><a href="https://www.typescriptlang.org/docs/handbook/basic-types.html" target="_blank" >any</a></code>

                        </td>
                    </tr>
                        <tr>
                            <td class="col-md-4">
                                    <div class="io-line">Defined in <a href="" data-line="64" class="link-to-prism">src/app/store/effects/poa-cost-assumption.effect.ts:64</a></div>
                            </td>
                        </tr>


            </tbody>
        </table>
        <table class="table table-sm table-bordered">
            <tbody>
                <tr>
                    <td class="col-md-4">
                        <a name="checkingPoaSurplusState"></a>
                        <span class="name">
                            <b>
                            checkingPoaSurplusState</b>
                            <a href="#checkingPoaSurplusState"><span class="icon ion-ios-link"></span></a>
                        </span>
                    </td>
                </tr>
                    <tr>
                        <td class="col-md-4">
                            <i>Default value : </i><code>this.action$.pipe(
    ofType(PoaCostAssumptionActionTypes.CheckingPoaCostAssumptionsState),
    withLatestFrom(this.store),
    map(
      ([action, appState]: [
        fromPoaCostAssumptionActions.CheckingPoaCostAssumptionsState,
        any
      ]) &#x3D;&gt; {
        const poaCostAssumptionsState &#x3D; appState.poaCostAssumption;
        const currentOrgunit &#x3D;
          appState.globalFilter.entities[&#x27;wisn_poa_page&#x27;].ou;
        const curentPeriod &#x3D; appState.globalFilter.entities[&#x27;wisn_poa_page&#x27;].pe;

        if (
          poaCostAssumptionsState.salaryCost.length &gt; 1 &amp;&amp;
          poaCostAssumptionsState.lastDataSelection.orgunit &#x3D;&#x3D;&#x3D;
            currentOrgunit.id &amp;&amp;
          poaCostAssumptionsState.lastDataSelection.period &#x3D;&#x3D;&#x3D; curentPeriod.id
        ) {
          // do nothing because state info is already there
          return new NoChangesOnPoaCostAssumptionsState();
        }
        // dispatch action for loading the wisnReport
        return new LoadPoaCostAssumptions();
      }
    )
  )</code>
                        </td>
                    </tr>
                    <tr>
                        <td class="col-md-4">
                            <b>Decorators : </b>
                            <br />
                            <code>
                                @Effect()<br />
                            </code>
                        </td>
                    </tr>
                        <tr>
                            <td class="col-md-4">
                                    <div class="io-line">Defined in <a href="" data-line="82" class="link-to-prism">src/app/store/effects/poa-cost-assumption.effect.ts:82</a></div>
                            </td>
                        </tr>


            </tbody>
        </table>
        <table class="table table-sm table-bordered">
            <tbody>
                <tr>
                    <td class="col-md-4">
                        <a name="costAssumptionProgram"></a>
                        <span class="name">
                            <b>
                            costAssumptionProgram</b>
                            <a href="#costAssumptionProgram"><span class="icon ion-ios-link"></span></a>
                        </span>
                    </td>
                </tr>
                    <tr>
                        <td class="col-md-4">
                            <i>Type : </i>        <code><a href="https://www.typescriptlang.org/docs/handbook/basic-types.html" target="_blank" >any</a></code>

                        </td>
                    </tr>
                        <tr>
                            <td class="col-md-4">
                                    <div class="io-line">Defined in <a href="" data-line="46" class="link-to-prism">src/app/store/effects/poa-cost-assumption.effect.ts:46</a></div>
                            </td>
                        </tr>


            </tbody>
        </table>
        <table class="table table-sm table-bordered">
            <tbody>
                <tr>
                    <td class="col-md-4">
                        <a name="costAssumptionProgramEventDataValues"></a>
                        <span class="name">
                            <b>
                            costAssumptionProgramEventDataValues</b>
                            <a href="#costAssumptionProgramEventDataValues"><span class="icon ion-ios-link"></span></a>
                        </span>
                    </td>
                </tr>
                    <tr>
                        <td class="col-md-4">
                            <i>Type : </i>    <code>any[]</code>

                        </td>
                    </tr>
                        <tr>
                            <td class="col-md-4">
                                    <div class="io-line">Defined in <a href="" data-line="63" class="link-to-prism">src/app/store/effects/poa-cost-assumption.effect.ts:63</a></div>
                            </td>
                        </tr>


            </tbody>
        </table>
        <table class="table table-sm table-bordered">
            <tbody>
                <tr>
                    <td class="col-md-4">
                        <a name="costAssumptionsPageDetails"></a>
                        <span class="name">
                            <b>
                            costAssumptionsPageDetails</b>
                            <a href="#costAssumptionsPageDetails"><span class="icon ion-ios-link"></span></a>
                        </span>
                    </td>
                </tr>
                    <tr>
                        <td class="col-md-4">
                            <i>Type : </i>        <code><a href="https://www.typescriptlang.org/docs/handbook/basic-types.html" target="_blank" >any</a></code>

                        </td>
                    </tr>
                        <tr>
                            <td class="col-md-4">
                                    <div class="io-line">Defined in <a href="" data-line="44" class="link-to-prism">src/app/store/effects/poa-cost-assumption.effect.ts:44</a></div>
                            </td>
                        </tr>


            </tbody>
        </table>
        <table class="table table-sm table-bordered">
            <tbody>
                <tr>
                    <td class="col-md-4">
                        <a name="currentDomElementFieldUpdated"></a>
                        <span class="name">
                            <b>
                            currentDomElementFieldUpdated</b>
                            <a href="#currentDomElementFieldUpdated"><span class="icon ion-ios-link"></span></a>
                        </span>
                    </td>
                </tr>
                    <tr>
                        <td class="col-md-4">
                            <i>Type : </i>        <code><a href="https://developer.mozilla.org/en-US/docs/Web/JavaScript/Reference/Global_Objects/string" target="_blank" >string</a></code>

                        </td>
                    </tr>
                        <tr>
                            <td class="col-md-4">
                                    <div class="io-line">Defined in <a href="" data-line="65" class="link-to-prism">src/app/store/effects/poa-cost-assumption.effect.ts:65</a></div>
                            </td>
                        </tr>


            </tbody>
        </table>
        <table class="table table-sm table-bordered">
            <tbody>
                <tr>
                    <td class="col-md-4">
                        <a name="currentUser"></a>
                        <span class="name">
                            <b>
                            currentUser</b>
                            <a href="#currentUser"><span class="icon ion-ios-link"></span></a>
                        </span>
                    </td>
                </tr>
                    <tr>
                        <td class="col-md-4">
                            <i>Type : </i>        <code><a href="https://www.typescriptlang.org/docs/handbook/basic-types.html" target="_blank" >any</a></code>

                        </td>
                    </tr>
                        <tr>
                            <td class="col-md-4">
                                    <div class="io-line">Defined in <a href="" data-line="58" class="link-to-prism">src/app/store/effects/poa-cost-assumption.effect.ts:58</a></div>
                            </td>
                        </tr>


            </tbody>
        </table>
        <table class="table table-sm table-bordered">
            <tbody>
                <tr>
                    <td class="col-md-4">
                        <a name="dataElements"></a>
                        <span class="name">
                            <b>
                            dataElements</b>
                            <a href="#dataElements"><span class="icon ion-ios-link"></span></a>
                        </span>
                    </td>
                </tr>
                    <tr>
                        <td class="col-md-4">
                            <i>Type : </i>        <code><a href="https://www.typescriptlang.org/docs/handbook/basic-types.html" target="_blank" >any</a></code>

                        </td>
                    </tr>
                        <tr>
                            <td class="col-md-4">
                                    <div class="io-line">Defined in <a href="" data-line="54" class="link-to-prism">src/app/store/effects/poa-cost-assumption.effect.ts:54</a></div>
                            </td>
                        </tr>


            </tbody>
        </table>
        <table class="table table-sm table-bordered">
            <tbody>
                <tr>
                    <td class="col-md-4">
                        <a name="eventData"></a>
                        <span class="name">
                            <b>
                            eventData</b>
                            <a href="#eventData"><span class="icon ion-ios-link"></span></a>
                        </span>
                    </td>
                </tr>
                    <tr>
                        <td class="col-md-4">
                            <i>Type : </i>        <code><a href="https://www.typescriptlang.org/docs/handbook/basic-types.html" target="_blank" >any</a></code>

                        </td>
                    </tr>
                        <tr>
                            <td class="col-md-4">
                                    <div class="io-line">Defined in <a href="" data-line="55" class="link-to-prism">src/app/store/effects/poa-cost-assumption.effect.ts:55</a></div>
                            </td>
                        </tr>


            </tbody>
        </table>
        <table class="table table-sm table-bordered">
            <tbody>
                <tr>
                    <td class="col-md-4">
                        <a name="lastUpdated"></a>
                        <span class="name">
                            <b>
                            lastUpdated</b>
                            <a href="#lastUpdated"><span class="icon ion-ios-link"></span></a>
                        </span>
                    </td>
                </tr>
                    <tr>
                        <td class="col-md-4">
                            <i>Type : </i>        <code><a href="https://developer.mozilla.org/en-US/docs/Web/JavaScript/Reference/Global_Objects/string" target="_blank" >string</a></code>

                        </td>
                    </tr>
                        <tr>
                            <td class="col-md-4">
                                    <div class="io-line">Defined in <a href="" data-line="53" class="link-to-prism">src/app/store/effects/poa-cost-assumption.effect.ts:53</a></div>
                            </td>
                        </tr>


            </tbody>
        </table>
        <table class="table table-sm table-bordered">
            <tbody>
                <tr>
                    <td class="col-md-4">
                        <a name="loadCostAssumptions$"></a>
                        <span class="name">
                            <b>
                            loadCostAssumptions$</b>
                            <a href="#loadCostAssumptions$"><span class="icon ion-ios-link"></span></a>
                        </span>
                    </td>
                </tr>
                    <tr>
                        <td class="col-md-4">
                            <i>Default value : </i><code>this.action$.pipe(
    ofType(PoaCostAssumptionActionTypes.LoadPoaCostAssumptions),
    withLatestFrom(this.store),
    map(
      ([action, appState]: [
        fromPoaCostAssumptionActions.LoadPoaCostAssumptions,
        any
      ]) &#x3D;&gt; {
        this.selectedOrgunit &#x3D;
          appState.globalFilter.entities[&#x27;wisn_poa_page&#x27;].ou;
        this.period &#x3D; appState.globalFilter.entities[&#x27;wisn_poa_page&#x27;].pe;
        const pageDetails &#x3D; appState.wisnPoaPages.entities[&#x27;poaanalysis&#x27;];
        const subPages &#x3D; pageDetails.subPages;
        this.cadreFromGeneralConfig &#x3D;
          appState.generalConfigurations.cadreData ?
            appState.generalConfigurations.cadreData : [];
        subPages.forEach((subPage: any) &#x3D;&gt; {
          if (subPage.id &#x3D;&#x3D;&#x3D; this.subPageId) {
            this.costAssumptionsPageDetails &#x3D; subPage;
          }
        });
        this.costAssumptionProgram &#x3D; this.costAssumptionsPageDetails.dataSource[0];
        this.currentUser &#x3D; appState.currentUser.user;
      }
    ),
    switchMap(() &#x3D;&gt;
      this.poaAnalyticsService.loadCostAssumptionsDataElements(
        this.costAssumptionProgram
      )
    ),
    map((costAssumptionsSectionStages: any) &#x3D;&gt; {
      const progressCounter &#x3D; Math.floor((Math.random() * 39) + 60);
      this.store.dispatch(new CostAssumputionsDataProgressLoader(progressCounter));
      const redistributionCostData &#x3D; [];
      const allowanceCostData &#x3D; [];
      const monthlySalaryData &#x3D; [];
      const maxBudgetHRHconstraintData &#x3D; [];
      const maxNumberHRHconstraintData &#x3D; [];
      const sectionCollections &#x3D;
        costAssumptionsSectionStages.programStages[0].programStageSections;
      this.redistributionCostDataElements &#x3D;
        sectionCollections[0].dataElements;
      this.allowanceCostDataElements &#x3D; sectionCollections[0].dataElements;
      this.monthlySalaryDataElements &#x3D; sectionCollections[1].dataElements;
      this.maxBudgetHRHconstraintDataElements &#x3D;
        sectionCollections[2].dataElements;
      this.maxNumberHRHconstraintDataElements &#x3D;
        sectionCollections[3].dataElements;
      this.dataElements &#x3D; this.redistributionCostDataElements.concat(
        this.allowanceCostDataElements,
        this.monthlySalaryDataElements,
        this.maxBudgetHRHconstraintDataElements,
        this.maxNumberHRHconstraintDataElements
      );
      this.analyticsDxCollection &#x3D; &#x27;&#x27;;
      this.redistributionCostDataElements.forEach((dx: any, index) &#x3D;&gt; {
        this.analyticsDxCollection +&#x3D; &#x27;dimension&#x3D;&#x27; + dx.id + &#x27;&amp;&#x27;;
        redistributionCostData.push({
          name: dx.displayFormName,
          entityName: &#x27;redistributionCost&#x27;,
          dataElementId: dx.id,
          isDisabled: (this.wisnPoaService.getUserPermissionAction(&#x27;redistributionCost&#x27;) &#x3D;&#x3D;&#x3D; &#x27;CAN_VIEW&#x27;) ? true : false,
          value: 0,
          storedBy: &#x27;&#x27;,
          orgunitId: this.selectedOrgunit.id,
          period: this.period,
          index: index,
          program: this.costAssumptionProgram
        });
      });
      // console.log(JSON.stringify(this.getPermissionAction(&#x27;redistributionCost&#x27;)));
      this.maxBudgetHRHconstraintDataElements.forEach((dx: any, index) &#x3D;&gt; {
        this.analyticsDxCollection +&#x3D; &#x27;dimension&#x3D;&#x27; + dx.id + &#x27;&amp;&#x27;;
        maxBudgetHRHconstraintData.push({
          entityName: &#x27;maximumBudget&#x27;,
          cadreCode: fromUtilHelpers.getFuzzyMatchCadreCode(dx.name, this.cadreFromGeneralConfig),
          name: dx.displayFormName,
          dataElementId: dx.id,
          value: 0,
          isDisabled: ((dx.displayFormName.includes(&#x27;Total&#x27;)) ? false : true ||
          (this.wisnPoaService.getUserPermissionAction(&#x27;maximumBudget&#x27;) &#x3D;&#x3D;&#x3D; &#x27;CAN_VIEW&#x27;) ? true : false),
          storedBy: &#x27;&#x27;,
          orgunitId: this.selectedOrgunit.id,
          period: this.period,
          index: index,
          program: this.costAssumptionProgram
        });
      });
      this.maxNumberHRHconstraintDataElements.forEach((dx: any, index) &#x3D;&gt; {
        this.analyticsDxCollection +&#x3D; &#x27;dimension&#x3D;&#x27; + dx.id + &#x27;&amp;&#x27;;
        maxNumberHRHconstraintData.push({
          entityName: &#x27;maximumNumber&#x27;,
          cadreCode: fromUtilHelpers.getFuzzyMatchCadreCode(dx.name, this.cadreFromGeneralConfig),
          name: dx.displayFormName,
          dataElementId: dx.id,
          value: 0,
          isDisabled: (this.wisnPoaService.getUserPermissionAction(&#x27;maximumNumber&#x27;) &#x3D;&#x3D;&#x3D; &#x27;CAN_VIEW&#x27;) ? true : false,
          storedBy: &#x27;&#x27;,
          orgunitId: this.selectedOrgunit.id,
          period: this.period,
          index: index,
          program: this.costAssumptionProgram,
          isLocked: false
        });
      });
      this.allowanceCostDataElements.forEach((dx: any, index) &#x3D;&gt; {
        this.analyticsDxCollection +&#x3D; &#x27;dimension&#x3D;&#x27; + dx.id + &#x27;&amp;&#x27;;
        allowanceCostData.push({
          name: dx.displayFormName,
          dataElementId: dx.id,
          value: 0,
          storedBy: &#x27;&#x27;,
          orgunitId: this.selectedOrgunit.id,
          period: this.period,
          index: index,
          program: this.costAssumptionProgram
        });
      });
      this.monthlySalaryDataElements.forEach((dx: any, index) &#x3D;&gt; {
        this.analyticsDxCollection +&#x3D; &#x27;dimension&#x3D;&#x27; + dx.id + &#x27;&amp;&#x27;;
        monthlySalaryData.push({
          entityName: &#x27;salaryCost&#x27;,
          cadreCode: fromUtilHelpers.getFuzzyMatchCadreCode(dx.name, this.cadreFromGeneralConfig),
          name: dx.displayFormName,
          dataElementId: dx.id,
          value: 0,
          isDisabled: (this.wisnPoaService.getUserPermissionAction(&#x27;salaryCost&#x27;) &#x3D;&#x3D;&#x3D; &#x27;CAN_VIEW&#x27;) ? true : false,
          storedBy: &#x27;&#x27;,
          orgunitId: this.selectedOrgunit.id,
          period: this.period,
          index: index,
          program: this.costAssumptionProgram
        });
      });
      this.maxBudgetHRHconstraintData &#x3D; maxBudgetHRHconstraintData;
      this.maxNumberHRHconstraintData &#x3D; maxNumberHRHconstraintData;
      this.redistributionCostData &#x3D; redistributionCostData;
      this.allowanceCostData &#x3D; allowanceCostData;
      this.monthlySalaryData &#x3D; monthlySalaryData;
    }),
    switchMap(() &#x3D;&gt;
      this.wisnAnalyticsService.getLatestMultipleEventDataValues(
        [{ id: this.selectedOrgunit.id }],
        this.costAssumptionProgram.id
      )
    ),
    map((eventData: any) &#x3D;&gt; {
      if (eventData.events.length &gt; 0) {
        this.eventData &#x3D; eventData.events ? eventData.events[0] : [];
        this.redistributionCostData.forEach((redistCost: any) &#x3D;&gt; {
          this.eventData.dataValues.forEach((dataValue: any) &#x3D;&gt; {
            if (redistCost.dataElementId &#x3D;&#x3D;&#x3D; dataValue.dataElement) {
              redistCost.value &#x3D; dataValue.value
                ? parseFloat(dataValue.value)
                : 0;
              redistCost.storedBy &#x3D; dataValue.storedBy ? dataValue.storedBy : &#x27;&#x27;;
            }
          });
        });
        this.maxBudgetHRHconstraintData.forEach((budgetConstraint: any) &#x3D;&gt; {
          this.eventData.dataValues.forEach((dataValue: any) &#x3D;&gt; {
            if (budgetConstraint.dataElementId &#x3D;&#x3D;&#x3D; dataValue.dataElement) {
              budgetConstraint.value &#x3D; dataValue.value
                ? parseFloat(dataValue.value)
                : 0;
              budgetConstraint.storedBy &#x3D; dataValue.storedBy
                ? dataValue.storedBy
                : &#x27;&#x27;;
            }
          });
        });
        this.allowanceCostData.forEach((allowanceCost: any) &#x3D;&gt; {
          this.eventData.dataValues.forEach((dataValue: any) &#x3D;&gt; {
            if (allowanceCost.dataElementId &#x3D;&#x3D;&#x3D; dataValue.dataElement) {
              allowanceCost.value &#x3D; dataValue.value
                ? parseFloat(dataValue.value)
                : 0;
              allowanceCost.storedBy &#x3D; dataValue.storedBy
                ? dataValue.storedBy
                : &#x27;&#x27;;
            }
          });
        });
        this.monthlySalaryData.forEach((montlhyCost: any) &#x3D;&gt; {
          this.eventData.dataValues.forEach((dataValue: any) &#x3D;&gt; {
            if (montlhyCost.dataElementId &#x3D;&#x3D;&#x3D; dataValue.dataElement) {
              montlhyCost.value &#x3D; dataValue.value
                ? parseFloat(dataValue.value)
                : 0;
              montlhyCost.storedBy &#x3D; dataValue.storedBy ? dataValue.storedBy : &#x27;&#x27;;
            }
          });
        });
        this.maxNumberHRHconstraintData.forEach((maxNumberHRH: any) &#x3D;&gt; {
          this.eventData.dataValues.forEach((dataValue: any) &#x3D;&gt; {
            if (maxNumberHRH.dataElementId &#x3D;&#x3D;&#x3D; dataValue.dataElement) {
              maxNumberHRH.value &#x3D; dataValue.value
                ? parseFloat(dataValue.value)
                : 0;
              maxNumberHRH.storedBy &#x3D; dataValue.storedBy
                ? dataValue.storedBy
                : &#x27;&#x27;;
            }
          });
        });
        this.maxBudgetHRHconstraintData &#x3D; fromCostAssumptionsHelpers
        .reCalculateMaximumBudget(this.maxNumberHRHconstraintData,
          this.maxBudgetHRHconstraintData, this.monthlySalaryData);

      } else {
        const dataValues &#x3D; [];
        this.dataElements.forEach((costAssumptionDX: any) &#x3D;&gt; {
          dataValues.push({
            dataElement: costAssumptionDX.id,
            value: &#x27;&#x27;
          });
        });
        this.eventData &#x3D; {
            program: this.costAssumptionProgram.id,
            orgUnit: this.selectedOrgunit.id,
            eventDate: this.todayTimeDate,
            status: &#x27;COMPLETED&#x27;,
            storedBy: this.currentUser.userCredentials.username ?
              this.currentUser.userCredentials.username : &#x27;&#x27;,
            coordinate: {
            latitude: 0,
            longitude: 0},
            dataValues: dataValues
        };
      }
      const lastDataSelection &#x3D; {
        orgunit: this.selectedOrgunit.id,
        period: this.period.id
      };
      this.store.dispatch(
        new AddPoaCostAssumption({
          lastDataSelection: lastDataSelection,
          allowanceCostData: this.redistributionCostData,
          maximumBudget: this.maxBudgetHRHconstraintData,
          maximumNumber: this.maxNumberHRHconstraintData,
          remainingMaxBudget: fromCostAssumptionsHelpers.remainingMaxBudget(this.maxBudgetHRHconstraintData),
          progressLoader: 100,
          redistributionCostData: {
            period: this.allowanceCostData[0],
            salaryCost: this.allowanceCostData.slice(1)
          },
          monthlySalaryData: this.monthlySalaryData
        })
      );
      this.store.dispatch(new AddPoaCostAssumptionProgram(this.eventData));
      this.store.dispatch(new CheckingPoaPriState());
      //  this.store.dispatch(new CostAssumptionsLoadMaxHRHFromPRIlist());
    }),
    catchError(error &#x3D;&gt;
      of(this.store.dispatch(new POAcostAssumputionsErrorHandler(error)))
    ) // fire an action to indicate that load data has failed
  )</code>
                        </td>
                    </tr>
                    <tr>
                        <td class="col-md-4">
                            <b>Decorators : </b>
                            <br />
                            <code>
                                @Effect({dispatch: false})<br />
                            </code>
                        </td>
                    </tr>
                        <tr>
                            <td class="col-md-4">
                                    <div class="io-line">Defined in <a href="" data-line="123" class="link-to-prism">src/app/store/effects/poa-cost-assumption.effect.ts:123</a></div>
                            </td>
                        </tr>


            </tbody>
        </table>
        <table class="table table-sm table-bordered">
            <tbody>
                <tr>
                    <td class="col-md-4">
                        <a name="loadMaxHRHfromPRI"></a>
                        <span class="name">
                            <b>
                            loadMaxHRHfromPRI</b>
                            <a href="#loadMaxHRHfromPRI"><span class="icon ion-ios-link"></span></a>
                        </span>
                    </td>
                </tr>
                    <tr>
                        <td class="col-md-4">
                            <i>Default value : </i><code>this.action$.pipe(
    ofType(PoaCostAssumptionActionTypes.CostAssumptionsLoadMaxHRHFromPRIlist),
    withLatestFrom(this.store.select(getPoaCostAssumptionsMaxNumberState),
    this.store.select(getPoaCostAssumptionsMaxBudgetState),
    this.store.select(getPoaCostAssumptionsSalaryCostState),
    this.store.select(getPoaPriEntitieState)
    ),
    map(([action, maximumHRH , maximumBudget, salaryCosts, priList]:
      [fromPoaCostAssumptionActions.CostAssumptionsLoadMaxHRHFromPRIlist, any, any, any, any]) &#x3D;&gt; {
        // klskf
       const updatedMaxHRH &#x3D; fromCostAssumptionsHelpers
       .calculateMaximumHRHfromPRI(maximumBudget, maximumHRH, salaryCosts, priList);
       const updatedMaxBudgets &#x3D; fromCostAssumptionsHelpers
       .reCalculateMaximumBudget(updatedMaxHRH,
        maximumBudget, salaryCosts);
        return new CostAssumputionsMaxNumberHRH({
          maximumBudget: updatedMaxBudgets,
          maximumNumber: updatedMaxHRH,
          remainingMaxBudget: fromCostAssumptionsHelpers.remainingMaxBudget(updatedMaxBudgets),
        });
    })
  )</code>
                        </td>
                    </tr>
                    <tr>
                        <td class="col-md-4">
                            <b>Decorators : </b>
                            <br />
                            <code>
                                @Effect()<br />
                            </code>
                        </td>
                    </tr>
                        <tr>
                            <td class="col-md-4">
                                    <div class="io-line">Defined in <a href="" data-line="562" class="link-to-prism">src/app/store/effects/poa-cost-assumption.effect.ts:562</a></div>
                            </td>
                        </tr>


            </tbody>
        </table>
        <table class="table table-sm table-bordered">
            <tbody>
                <tr>
                    <td class="col-md-4">
                        <a name="maxBudgetHRHconstraintData"></a>
                        <span class="name">
                            <b>
                            maxBudgetHRHconstraintData</b>
                            <a href="#maxBudgetHRHconstraintData"><span class="icon ion-ios-link"></span></a>
                        </span>
                    </td>
                </tr>
                    <tr>
                        <td class="col-md-4">
                            <i>Type : </i>    <code>any[]</code>

                        </td>
                    </tr>
                        <tr>
                            <td class="col-md-4">
                                    <div class="io-line">Defined in <a href="" data-line="60" class="link-to-prism">src/app/store/effects/poa-cost-assumption.effect.ts:60</a></div>
                            </td>
                        </tr>


            </tbody>
        </table>
        <table class="table table-sm table-bordered">
            <tbody>
                <tr>
                    <td class="col-md-4">
                        <a name="maxBudgetHRHconstraintDataElements"></a>
                        <span class="name">
                            <b>
                            maxBudgetHRHconstraintDataElements</b>
                            <a href="#maxBudgetHRHconstraintDataElements"><span class="icon ion-ios-link"></span></a>
                        </span>
                    </td>
                </tr>
                    <tr>
                        <td class="col-md-4">
                            <i>Type : </i>        <code><a href="https://www.typescriptlang.org/docs/handbook/basic-types.html" target="_blank" >any</a></code>

                        </td>
                    </tr>
                        <tr>
                            <td class="col-md-4">
                                    <div class="io-line">Defined in <a href="" data-line="50" class="link-to-prism">src/app/store/effects/poa-cost-assumption.effect.ts:50</a></div>
                            </td>
                        </tr>


            </tbody>
        </table>
        <table class="table table-sm table-bordered">
            <tbody>
                <tr>
                    <td class="col-md-4">
                        <a name="maxNumberHRHconstraintData"></a>
                        <span class="name">
                            <b>
                            maxNumberHRHconstraintData</b>
                            <a href="#maxNumberHRHconstraintData"><span class="icon ion-ios-link"></span></a>
                        </span>
                    </td>
                </tr>
                    <tr>
                        <td class="col-md-4">
                            <i>Type : </i>    <code>any[]</code>

                        </td>
                    </tr>
                        <tr>
                            <td class="col-md-4">
                                    <div class="io-line">Defined in <a href="" data-line="61" class="link-to-prism">src/app/store/effects/poa-cost-assumption.effect.ts:61</a></div>
                            </td>
                        </tr>


            </tbody>
        </table>
        <table class="table table-sm table-bordered">
            <tbody>
                <tr>
                    <td class="col-md-4">
                        <a name="maxNumberHRHconstraintDataElements"></a>
                        <span class="name">
                            <b>
                            maxNumberHRHconstraintDataElements</b>
                            <a href="#maxNumberHRHconstraintDataElements"><span class="icon ion-ios-link"></span></a>
                        </span>
                    </td>
                </tr>
                    <tr>
                        <td class="col-md-4">
                            <i>Type : </i>        <code><a href="https://www.typescriptlang.org/docs/handbook/basic-types.html" target="_blank" >any</a></code>

                        </td>
                    </tr>
                        <tr>
                            <td class="col-md-4">
                                    <div class="io-line">Defined in <a href="" data-line="51" class="link-to-prism">src/app/store/effects/poa-cost-assumption.effect.ts:51</a></div>
                            </td>
                        </tr>


            </tbody>
        </table>
        <table class="table table-sm table-bordered">
            <tbody>
                <tr>
                    <td class="col-md-4">
                        <a name="monthlySalaryData"></a>
                        <span class="name">
                            <b>
                            monthlySalaryData</b>
                            <a href="#monthlySalaryData"><span class="icon ion-ios-link"></span></a>
                        </span>
                    </td>
                </tr>
                    <tr>
                        <td class="col-md-4">
                            <i>Type : </i>    <code>any[]</code>

                        </td>
                    </tr>
                        <tr>
                            <td class="col-md-4">
                                    <div class="io-line">Defined in <a href="" data-line="59" class="link-to-prism">src/app/store/effects/poa-cost-assumption.effect.ts:59</a></div>
                            </td>
                        </tr>


            </tbody>
        </table>
        <table class="table table-sm table-bordered">
            <tbody>
                <tr>
                    <td class="col-md-4">
                        <a name="monthlySalaryDataElements"></a>
                        <span class="name">
                            <b>
                            monthlySalaryDataElements</b>
                            <a href="#monthlySalaryDataElements"><span class="icon ion-ios-link"></span></a>
                        </span>
                    </td>
                </tr>
                    <tr>
                        <td class="col-md-4">
                            <i>Type : </i>        <code><a href="https://www.typescriptlang.org/docs/handbook/basic-types.html" target="_blank" >any</a></code>

                        </td>
                    </tr>
                        <tr>
                            <td class="col-md-4">
                                    <div class="io-line">Defined in <a href="" data-line="49" class="link-to-prism">src/app/store/effects/poa-cost-assumption.effect.ts:49</a></div>
                            </td>
                        </tr>


            </tbody>
        </table>
        <table class="table table-sm table-bordered">
            <tbody>
                <tr>
                    <td class="col-md-4">
                        <a name="period"></a>
                        <span class="name">
                            <b>
                            period</b>
                            <a href="#period"><span class="icon ion-ios-link"></span></a>
                        </span>
                    </td>
                </tr>
                    <tr>
                        <td class="col-md-4">
                            <i>Type : </i>        <code><a href="https://www.typescriptlang.org/docs/handbook/basic-types.html" target="_blank" >any</a></code>

                        </td>
                    </tr>
                        <tr>
                            <td class="col-md-4">
                                    <div class="io-line">Defined in <a href="" data-line="42" class="link-to-prism">src/app/store/effects/poa-cost-assumption.effect.ts:42</a></div>
                            </td>
                        </tr>


            </tbody>
        </table>
        <table class="table table-sm table-bordered">
            <tbody>
                <tr>
                    <td class="col-md-4">
                        <a name="redistributionCostData"></a>
                        <span class="name">
                            <b>
                            redistributionCostData</b>
                            <a href="#redistributionCostData"><span class="icon ion-ios-link"></span></a>
                        </span>
                    </td>
                </tr>
                    <tr>
                        <td class="col-md-4">
                            <i>Type : </i>    <code>any[]</code>

                        </td>
                    </tr>
                        <tr>
                            <td class="col-md-4">
                                    <div class="io-line">Defined in <a href="" data-line="56" class="link-to-prism">src/app/store/effects/poa-cost-assumption.effect.ts:56</a></div>
                            </td>
                        </tr>


            </tbody>
        </table>
        <table class="table table-sm table-bordered">
            <tbody>
                <tr>
                    <td class="col-md-4">
                        <a name="redistributionCostDataElements"></a>
                        <span class="name">
                            <b>
                            redistributionCostDataElements</b>
                            <a href="#redistributionCostDataElements"><span class="icon ion-ios-link"></span></a>
                        </span>
                    </td>
                </tr>
                    <tr>
                        <td class="col-md-4">
                            <i>Type : </i>        <code><a href="https://www.typescriptlang.org/docs/handbook/basic-types.html" target="_blank" >any</a></code>

                        </td>
                    </tr>
                        <tr>
                            <td class="col-md-4">
                                    <div class="io-line">Defined in <a href="" data-line="47" class="link-to-prism">src/app/store/effects/poa-cost-assumption.effect.ts:47</a></div>
                            </td>
                        </tr>


            </tbody>
        </table>
        <table class="table table-sm table-bordered">
            <tbody>
                <tr>
                    <td class="col-md-4">
                        <a name="selectedOrgunit"></a>
                        <span class="name">
                            <b>
                            selectedOrgunit</b>
                            <a href="#selectedOrgunit"><span class="icon ion-ios-link"></span></a>
                        </span>
                    </td>
                </tr>
                    <tr>
                        <td class="col-md-4">
                            <i>Type : </i>        <code><a href="https://www.typescriptlang.org/docs/handbook/basic-types.html" target="_blank" >any</a></code>

                        </td>
                    </tr>
                        <tr>
                            <td class="col-md-4">
                                    <div class="io-line">Defined in <a href="" data-line="43" class="link-to-prism">src/app/store/effects/poa-cost-assumption.effect.ts:43</a></div>
                            </td>
                        </tr>


            </tbody>
        </table>
        <table class="table table-sm table-bordered">
            <tbody>
                <tr>
                    <td class="col-md-4">
                        <a name="singleEventUpload"></a>
                        <span class="name">
                            <b>
                            singleEventUpload</b>
                            <a href="#singleEventUpload"><span class="icon ion-ios-link"></span></a>
                        </span>
                    </td>
                </tr>
                    <tr>
                        <td class="col-md-4">
                            <i>Type : </i>        <code><a href="https://www.typescriptlang.org/docs/handbook/basic-types.html" target="_blank" >any</a></code>

                        </td>
                    </tr>
                        <tr>
                            <td class="col-md-4">
                                    <div class="io-line">Defined in <a href="" data-line="62" class="link-to-prism">src/app/store/effects/poa-cost-assumption.effect.ts:62</a></div>
                            </td>
                        </tr>


            </tbody>
        </table>
        <table class="table table-sm table-bordered">
            <tbody>
                <tr>
                    <td class="col-md-4">
                        <a name="subPageId"></a>
                        <span class="name">
                            <b>
                            subPageId</b>
                            <a href="#subPageId"><span class="icon ion-ios-link"></span></a>
                        </span>
                    </td>
                </tr>
                    <tr>
                        <td class="col-md-4">
                            <i>Type : </i>        <code><a href="https://developer.mozilla.org/en-US/docs/Web/JavaScript/Reference/Global_Objects/string" target="_blank" >string</a></code>

                        </td>
                    </tr>
                    <tr>
                        <td class="col-md-4">
                            <i>Default value : </i><code>&#x27;costassumptions&#x27;</code>
                        </td>
                    </tr>
                        <tr>
                            <td class="col-md-4">
                                    <div class="io-line">Defined in <a href="" data-line="45" class="link-to-prism">src/app/store/effects/poa-cost-assumption.effect.ts:45</a></div>
                            </td>
                        </tr>


            </tbody>
        </table>
        <table class="table table-sm table-bordered">
            <tbody>
                <tr>
                    <td class="col-md-4">
                        <a name="todayTimeDate"></a>
                        <span class="name">
                            <b>
                            todayTimeDate</b>
                            <a href="#todayTimeDate"><span class="icon ion-ios-link"></span></a>
                        </span>
                    </td>
                </tr>
                    <tr>
                        <td class="col-md-4">
                            <i>Type : </i>        <code><a href="https://developer.mozilla.org/en-US/docs/Web/JavaScript/Reference/Global_Objects/string" target="_blank" >string</a></code>

                        </td>
                    </tr>
                    <tr>
                        <td class="col-md-4">
                            <i>Default value : </i><code>&#x27;&#x27; +
    new Date().getFullYear() +
    &#x27;-&#x27; +
    (1 + new Date().getMonth()) +
    &#x27;-&#x27; +
    new Date().getDate()</code>
                        </td>
                    </tr>
                        <tr>
                            <td class="col-md-4">
                                    <div class="io-line">Defined in <a href="" data-line="66" class="link-to-prism">src/app/store/effects/poa-cost-assumption.effect.ts:66</a></div>
                            </td>
                        </tr>


            </tbody>
        </table>
        <table class="table table-sm table-bordered">
            <tbody>
                <tr>
                    <td class="col-md-4">
                        <a name="updatingCostAssumptionProgramValues$"></a>
                        <span class="name">
                            <b>
                            updatingCostAssumptionProgramValues$</b>
                            <a href="#updatingCostAssumptionProgramValues$"><span class="icon ion-ios-link"></span></a>
                        </span>
                    </td>
                </tr>
                    <tr>
                        <td class="col-md-4">
                            <i>Default value : </i><code>this.action$.pipe(
    ofType(PoaCostAssumptionActionTypes.UpdatingPoaCostAssumptionsProgram),
    withLatestFrom(this.store.select(getPoaPriEntitieState),
    this.store.select(getPoaCostAssumptionsMaxNumberState),
    this.store.select(getPoaCostAssumptionsMaxBudgetState),
    this.store.select(getPoaCostAssumptionsSalaryCostState)),
    map(
      (
        [action, priState, maxHRHdata, maxBudget, salaryData]:
        [fromPoaCostAssumptionActions.UpdatingPoaCostAssumptionsProgram, any, any, any, any]
      ) &#x3D;&gt; {
        // use another variable to avoid varialble reference
        const newMaxNumberHRHconstraintData &#x3D; (maxHRHdata || []).map(maxHRH &#x3D;&gt; Object.assign({}, maxHRH));
        const maxBudgetHRHconstraintData &#x3D; (maxBudget || []).map(budget &#x3D;&gt; Object.assign({}, budget));
        const monthlySalaryData &#x3D; (salaryData || []).map(salary &#x3D;&gt; Object.assign({}, salary));
        const priData &#x3D; (priState || []).map(pri &#x3D;&gt; Object.assign({}, pri));
        this.currentDomElementFieldUpdated &#x3D;
          action.payload.changedData.domElementId;
          // this code will handle scenarios when maximumNumber section is being edited
        if (action.payload.rowData.entityName &#x3D;&#x3D;&#x3D; &#x27;maximumNumber&#x27;) {
            // use another variable to avoid varialble reference
          const maximumHRH &#x3D; (maxHRHdata || []).map(maxHRH &#x3D;&gt; Object.assign({}, maxHRH));
          let backUpValueMaxHRH &#x3D; 0;
          const updatedMaxHRHTemp &#x3D; maximumHRH.map(maxHRH &#x3D;&gt; {
            if (maxHRH.cadreCode &#x3D;&#x3D;&#x3D; action.payload.rowData.cadreCode) {
              backUpValueMaxHRH &#x3D; maxHRH.value;
              maxHRH.isLocked &#x3D; true;
              maxHRH.value &#x3D; action.payload.changedData.value;
            }
            return maxHRH;
          });

          let updatedMaxBudgets &#x3D; fromCostAssumptionsHelpers
          .reCalculateMaximumBudget(updatedMaxHRHTemp,
            maxBudgetHRHconstraintData, monthlySalaryData);
           const remainingBudget &#x3D; fromCostAssumptionsHelpers.remainingMaxBudget(updatedMaxBudgets);
           const updatedMaxHRH &#x3D; fromCostAssumptionsHelpers
           .computeMaxHRHBasedOnRemaingBudget(remainingBudget, updatedMaxHRHTemp, monthlySalaryData, priData);
           updatedMaxBudgets &#x3D; fromCostAssumptionsHelpers
          .reCalculateMaximumBudget(updatedMaxHRH,
            maxBudgetHRHconstraintData, monthlySalaryData);

          const updatedTotalMaxBudgets &#x3D; fromCostAssumptionsHelpers.processTotalSalaryCost(updatedMaxBudgets);
          const totalMaxBudgetIndex &#x3D; maxBudgetHRHconstraintData
            .findIndex(budget &#x3D;&gt; budget.name.toLowerCase().indexOf(&#x27;total&#x27;) &gt; -1);
          const totalMaxBudgetValue &#x3D; maxBudgetHRHconstraintData[totalMaxBudgetIndex].value;
            if (updatedTotalMaxBudgets &gt; totalMaxBudgetValue) {
              alert(&#x27;Sorry, the value entered cant be accepted because it exceeded max number of HRH based on budget available&#x27;);
              action.payload.changedData.value &#x3D; backUpValueMaxHRH;
              this.store.dispatch(new UpsertPoaCostAssumption(action.payload)); // upserting the value to the store
              this.singleEventUpload &#x3D; {};
              this.currentDomElementFieldUpdated &#x3D; &#x27;&#x27;;
              try {
                document.getElementById(
                  action.payload.changedData.domElementId
                ).style.backgroundColor &#x3D; &#x27;white&#x27;;
              } catch (e) {}
            } else {
                // update all maxHRH values to maintain consistency on intial loading
              this.eventData.dataValues.forEach(dataValue &#x3D;&gt; {
                updatedMaxHRH.forEach(maxhrh &#x3D;&gt; {
                  if (dataValue.dataElement &#x3D;&#x3D;&#x3D; maxhrh.dataElementId) {
                    dataValue.value &#x3D; maxhrh.value;
                  }
                });
              });
              const currentCadre &#x3D; newMaxNumberHRHconstraintData.filter(maxHRH &#x3D;&gt; maxHRH.cadreCode &#x3D;&#x3D;&#x3D; action.payload.rowData.cadreCode);
        const newEventDataValuesFormat &#x3D; fromCostAssumptionsHelpers
        .generateCostAssumptionImportFormat(this.eventData, action, currentCadre[0].value ? currentCadre[0].value : 0);
              this.costAssumptionProgramEventDataValues &#x3D; newEventDataValuesFormat;
              this.singleEventUpload &#x3D; newEventDataValuesFormat;
              // update store with new changes
              this.store.dispatch(new CostAssumputionsMaxNumberHRH({
                maximumBudget: updatedMaxBudgets,
                maximumNumber: updatedMaxHRH,
                remainingMaxBudget: fromCostAssumptionsHelpers.remainingMaxBudget(updatedMaxBudgets),
              })); // upserting the value to the store
            }
        } else if (action.payload.rowData.entityName &#x3D;&#x3D;&#x3D; &#x27;salaryCost&#x27;) {
          let eventDataValuesFormat &#x3D; [];
          const newMonthlySalaryData &#x3D; monthlySalaryData.map(salary &#x3D;&gt; {
            if (salary.dataElementId &#x3D;&#x3D;&#x3D; action.payload.rowData.dataElementId) {
              salary.value &#x3D; action.payload.changedData.value;
            }
            return salary;
          });
          const updatedMaxHRH &#x3D; fromCostAssumptionsHelpers
          .calculateMaximumHRHfromPRI(maxBudgetHRHconstraintData,
            newMaxNumberHRHconstraintData, monthlySalaryData, priData);

        const updatedMaxBudgets &#x3D; fromCostAssumptionsHelpers
        .reCalculateMaximumBudget(newMaxNumberHRHconstraintData,
          maxBudgetHRHconstraintData, monthlySalaryData);
        const currentCadre &#x3D; newMaxNumberHRHconstraintData.filter(maxHRH &#x3D;&gt; maxHRH.cadreCode &#x3D;&#x3D;&#x3D; action.payload.rowData.cadreCode);
        if (currentCadre) {
         const currentData &#x3D; updatedMaxBudgets.filter(budget &#x3D;&gt; budget.name.toLowerCase().includes(&#x27;total&#x27;));
        eventDataValuesFormat &#x3D; fromCostAssumptionsHelpers
        .generateCostAssumptionImportFormat(this.eventData, action, currentData[0].value ? currentData[0].value : 0);
        } else {
          eventDataValuesFormat &#x3D; fromCostAssumptionsHelpers
          .generateCostAssumptionImportFormat(this.eventData, action, currentCadre[0].value ? currentCadre[0].value : 0);
        }
          this.costAssumptionProgramEventDataValues &#x3D; eventDataValuesFormat;
          this.singleEventUpload &#x3D; eventDataValuesFormat;
          this.store.dispatch(new CostAssumputionsSalaryCost({
            salaryCost: newMonthlySalaryData,
            maximumBudget: updatedMaxBudgets,
            maximumNumber: updatedMaxHRH,
            remainingMaxBudget: fromCostAssumptionsHelpers.remainingMaxBudget(updatedMaxBudgets),
          }));
        } else if (action.payload.rowData.entityName &#x3D;&#x3D;&#x3D; &#x27;maximumBudget&#x27;) {
          let updatedMaxBudgets &#x3D; maxBudgetHRHconstraintData.map(maxBudgetHRH &#x3D;&gt; {
            if (maxBudgetHRH.dataElementId &#x3D;&#x3D;&#x3D; action.payload.rowData.dataElementId) {
              maxBudgetHRH.value &#x3D; action.payload.changedData.value;
            }
            return maxBudgetHRH;
          });

          const updatedMaxHRH &#x3D; fromCostAssumptionsHelpers
          .calculateMaximumHRH(updatedMaxBudgets,
            newMaxNumberHRHconstraintData, monthlySalaryData);

          updatedMaxBudgets &#x3D; fromCostAssumptionsHelpers
        .reCalculateMaximumBudget(updatedMaxHRH,
          updatedMaxBudgets, monthlySalaryData);

          const currentData &#x3D; updatedMaxBudgets.filter(budget &#x3D;&gt; budget.name.toLowerCase().includes(&#x27;total&#x27;));
        const eventDataValuesFormat &#x3D; fromCostAssumptionsHelpers
        .generateCostAssumptionImportFormat(this.eventData, action, currentData[0].value ? currentData[0].value : 0);

          this.costAssumptionProgramEventDataValues &#x3D; eventDataValuesFormat;
          this.singleEventUpload &#x3D; eventDataValuesFormat;
          this.store.dispatch(new CostAssumputionsMaxNumberHRH({
            maximumBudget: updatedMaxBudgets,
            maximumNumber: updatedMaxHRH,
            remainingMaxBudget: fromCostAssumptionsHelpers.remainingMaxBudget(updatedMaxBudgets),
          })); // upserting the value to the store

          this.store.dispatch(new CostAssumptionsLoadMaxHRHFromPRIlist());
        } else if (action.payload.rowData.entityName &#x3D;&#x3D;&#x3D; &#x27;redistributionCost&#x27;) {
          this.eventData.dataValues.forEach(dataValue &#x3D;&gt; {
            if (dataValue.dataElement &#x3D;&#x3D;&#x3D; action.payload.changedData.dataElementId) {
              dataValue.value &#x3D; action.payload.changedData.value;
            }
          });
          this.store.dispatch(new UpsertPoaCostAssumption(action.payload)); // upserting the value to the store
          this.costAssumptionProgramEventDataValues &#x3D; this.eventData;
          this.singleEventUpload &#x3D; this.eventData;
        }
      }
    ),
    switchMap(() &#x3D;&gt;
      this.wisnAnalyticsService.updateSingleProgramDataValue(
        this.singleEventUpload
      )
    ),
    map((response: any) &#x3D;&gt; {
      try {
        document.getElementById(
          this.currentDomElementFieldUpdated
        ).style.backgroundColor &#x3D; &#x27;#b9ffb9&#x27;;
        document.getElementById(
          this.currentDomElementFieldUpdated
        ).style.borderColor &#x3D; &#x27;#dc3545&#x27;;
      } catch (e) {}
      return new AddPoaCostAssumptionProgram(
        this.costAssumptionProgramEventDataValues
      );
    }),
    catchError(
      error &#x3D;&gt;
        (document.getElementById(
          this.currentDomElementFieldUpdated
        ).style.backgroundColor &#x3D; &#x27;#ebd1d6&#x27;)
    )
  )</code>
                        </td>
                    </tr>
                    <tr>
                        <td class="col-md-4">
                            <b>Decorators : </b>
                            <br />
                            <code>
                                @Effect({dispatch: false})<br />
                            </code>
                        </td>
                    </tr>
                        <tr>
                            <td class="col-md-4">
                                    <div class="io-line">Defined in <a href="" data-line="382" class="link-to-prism">src/app/store/effects/poa-cost-assumption.effect.ts:382</a></div>
                            </td>
                        </tr>


            </tbody>
        </table>
</section>

    </div>


    <div class="tab-pane fade  tab-source-code" id="c-source">
        <pre class="line-numbers compodoc-sourcecode"><code class="language-typescript">import { Injectable } from &#x27;@angular/core&#x27;;
import { AppState } from &#x27;../reducers&#x27;;
import { Actions, Effect, ofType } from &#x27;@ngrx/effects&#x27;;
import { Store } from &#x27;@ngrx/store&#x27;;
import {
  catchError,
  map,
  switchMap,
  tap,
  withLatestFrom
} from &#x27;rxjs/operators&#x27;;
import * as fromPoaCostAssumptionActions from &#x27;../actions/poa-cost-assumption.actions&#x27;;
import {CheckingPoaCostAssumptionsState, PoaCostAssumptionActionTypes,
  CostAssumptionsLoadMaxHRHFromPRIlist} from &#x27;../actions/poa-cost-assumption.actions&#x27;;
import { PoaAnalyticsService } from &#x27;../../shared/services/poa-analytics.service&#x27;;
import { AddPoaCostAssumption } from &#x27;../actions/poa-cost-assumption.actions&#x27;;
import { of, Observable } from &#x27;rxjs&#x27;;
import { NoChangesOnPoaCostAssumptionsState } from &#x27;../actions/poa-cost-assumption.actions&#x27;;
import { LoadPoaCostAssumptions } from &#x27;../actions/poa-cost-assumption.actions&#x27;;
import { LoadPoaCostAssumptionsProgram } from &#x27;../actions/poa-cost-assumption.actions&#x27;;
import { AddPoaCostAssumptionProgram } from &#x27;../actions/poa-cost-assumption.actions&#x27;;
import { UpsertPoaCostAssumption } from &#x27;../actions/poa-cost-assumption.actions&#x27;;
import { WisnAnalyticsService } from &#x27;../../shared/services/wisn-analytics.service&#x27;;
import { POAcostAssumputionsErrorHandler } from &#x27;../actions/poa-cost-assumption.actions&#x27;;
import {CostAssumputionsDataProgressLoader} from &#x27;../actions/poa-cost-assumption.actions&#x27;;
import {WisnPoaPageService} from &#x27;../../shared/services/wisn-poa-page.service&#x27;;
import * as fromUtilHelpers from &#x27;../../shared/helpers/util-functions&#x27;;
import {CostAssumputionsSalaryCost} from &#x27;../actions/poa-cost-assumption.actions&#x27;;
import {CostAssumputionsMaxNumberHRH} from &#x27;../actions/poa-cost-assumption.actions&#x27;;
import {AddPoaPriList, PoaPriListActionTypes, CheckingPoaPriState} from &#x27;../actions/poa-pri-list.actions&#x27;;
import * as fromPOAPRIlistActions from &#x27;../actions/poa-pri-list.actions&#x27;;
import { currentUserRolePermissions } from &#x27;../selectors/general-configuration.selector&#x27;;
import * as fromCostAssumptionsHelpers from &#x27;../../shared/helpers/cost-assumptions.helpers&#x27;;
import { getPoaPriEntitieState } from &#x27;../selectors/poa-pri.selectors&#x27;;
import { getPoaCostAssumptionsMaxBudgetState, getPoaCostAssumptionsMaxNumberState,
  getPoaCostAssumptionsSalaryCostState, 
  getPoaCostAssumptionsmaxHRHLoaded,
  getPoaCostAssumptionsMaxNumberValues} from &#x27;../selectors/poa-cost-assumptions.selectors&#x27;;

@Injectable()
export class PoaCostAssumptionEffect {
  period: any;
  selectedOrgunit: any;
  costAssumptionsPageDetails: any;
  subPageId &#x3D; &#x27;costassumptions&#x27;;
  costAssumptionProgram: any;
  redistributionCostDataElements: any;
  allowanceCostDataElements: any;
  monthlySalaryDataElements: any;
  maxBudgetHRHconstraintDataElements: any;
  maxNumberHRHconstraintDataElements: any;
  analyticsDxCollection: string;
  lastUpdated: string;
  dataElements: any;
  eventData: any;
  redistributionCostData: any[];
  allowanceCostData: any[];
  currentUser: any;
  monthlySalaryData: any[];
  maxBudgetHRHconstraintData: any[];
  maxNumberHRHconstraintData: any[];
  singleEventUpload: any;
  costAssumptionProgramEventDataValues: any[];
  cadreFromGeneralConfig: any;
  currentDomElementFieldUpdated: string;
  todayTimeDate: string &#x3D;
    &#x27;&#x27; +
    new Date().getFullYear() +
    &#x27;-&#x27; +
    (1 + new Date().getMonth()) +
    &#x27;-&#x27; +
    new Date().getDate();
  constructor(
    private action$: Actions,
    private poaAnalyticsService: PoaAnalyticsService,
    private wisnAnalyticsService: WisnAnalyticsService,
    private wisnPoaService: WisnPoaPageService,
    private store: Store&lt;AppState&gt;
  ) {}

  @Effect()
  checkingPoaSurplusState &#x3D; this.action$.pipe(
    ofType(PoaCostAssumptionActionTypes.CheckingPoaCostAssumptionsState),
    withLatestFrom(this.store),
    map(
      ([action, appState]: [
        fromPoaCostAssumptionActions.CheckingPoaCostAssumptionsState,
        any
      ]) &#x3D;&gt; {
        const poaCostAssumptionsState &#x3D; appState.poaCostAssumption;
        const currentOrgunit &#x3D;
          appState.globalFilter.entities[&#x27;wisn_poa_page&#x27;].ou;
        const curentPeriod &#x3D; appState.globalFilter.entities[&#x27;wisn_poa_page&#x27;].pe;

        if (
          poaCostAssumptionsState.salaryCost.length &gt; 1 &amp;&amp;
          poaCostAssumptionsState.lastDataSelection.orgunit &#x3D;&#x3D;&#x3D;
            currentOrgunit.id &amp;&amp;
          poaCostAssumptionsState.lastDataSelection.period &#x3D;&#x3D;&#x3D; curentPeriod.id
        ) {
          // do nothing because state info is already there
          return new NoChangesOnPoaCostAssumptionsState();
        }
        // dispatch action for loading the wisnReport
        return new LoadPoaCostAssumptions();
      }
    )
  );

  // @Effect({ dispatch: false })
  // backgroundLoadCostAssumptions$ &#x3D; this.action$.pipe(
  //   ofType(PoaPriListActionTypes.AddPoaPriList),
  //   withLatestFrom(this.store.select(getPoaCostAssumptionsmaxHRHLoaded)),
  //   tap(([action, maxHRHLoaded]: [fromPOAPRIlistActions.AddPoaPriList, any]) &#x3D;&gt; {
  //     this.store.dispatch(new CheckingPoaCostAssumptionsState());
  //     if (maxHRHLoaded &#x3D;&#x3D;&#x3D; false) {
  //       this.store.dispatch(new CostAssumptionsLoadMaxHRHFromPRIlist());
  //     }
  //   })
  // );

  @Effect({ dispatch: false })
  loadCostAssumptions$ &#x3D; this.action$.pipe(
    ofType(PoaCostAssumptionActionTypes.LoadPoaCostAssumptions),
    withLatestFrom(this.store),
    map(
      ([action, appState]: [
        fromPoaCostAssumptionActions.LoadPoaCostAssumptions,
        any
      ]) &#x3D;&gt; {
        this.selectedOrgunit &#x3D;
          appState.globalFilter.entities[&#x27;wisn_poa_page&#x27;].ou;
        this.period &#x3D; appState.globalFilter.entities[&#x27;wisn_poa_page&#x27;].pe;
        const pageDetails &#x3D; appState.wisnPoaPages.entities[&#x27;poaanalysis&#x27;];
        const subPages &#x3D; pageDetails.subPages;
        this.cadreFromGeneralConfig &#x3D;
          appState.generalConfigurations.cadreData ?
            appState.generalConfigurations.cadreData : [];
        subPages.forEach((subPage: any) &#x3D;&gt; {
          if (subPage.id &#x3D;&#x3D;&#x3D; this.subPageId) {
            this.costAssumptionsPageDetails &#x3D; subPage;
          }
        });
        this.costAssumptionProgram &#x3D; this.costAssumptionsPageDetails.dataSource[0];
        this.currentUser &#x3D; appState.currentUser.user;
      }
    ),
    switchMap(() &#x3D;&gt;
      this.poaAnalyticsService.loadCostAssumptionsDataElements(
        this.costAssumptionProgram
      )
    ),
    map((costAssumptionsSectionStages: any) &#x3D;&gt; {
      const progressCounter &#x3D; Math.floor((Math.random() * 39) + 60);
      this.store.dispatch(new CostAssumputionsDataProgressLoader(progressCounter));
      const redistributionCostData &#x3D; [];
      const allowanceCostData &#x3D; [];
      const monthlySalaryData &#x3D; [];
      const maxBudgetHRHconstraintData &#x3D; [];
      const maxNumberHRHconstraintData &#x3D; [];
      const sectionCollections &#x3D;
        costAssumptionsSectionStages.programStages[0].programStageSections;
      this.redistributionCostDataElements &#x3D;
        sectionCollections[0].dataElements;
      this.allowanceCostDataElements &#x3D; sectionCollections[0].dataElements;
      this.monthlySalaryDataElements &#x3D; sectionCollections[1].dataElements;
      this.maxBudgetHRHconstraintDataElements &#x3D;
        sectionCollections[2].dataElements;
      this.maxNumberHRHconstraintDataElements &#x3D;
        sectionCollections[3].dataElements;
      this.dataElements &#x3D; this.redistributionCostDataElements.concat(
        this.allowanceCostDataElements,
        this.monthlySalaryDataElements,
        this.maxBudgetHRHconstraintDataElements,
        this.maxNumberHRHconstraintDataElements
      );
      this.analyticsDxCollection &#x3D; &#x27;&#x27;;
      this.redistributionCostDataElements.forEach((dx: any, index) &#x3D;&gt; {
        this.analyticsDxCollection +&#x3D; &#x27;dimension&#x3D;&#x27; + dx.id + &#x27;&amp;&#x27;;
        redistributionCostData.push({
          name: dx.displayFormName,
          entityName: &#x27;redistributionCost&#x27;,
          dataElementId: dx.id,
          isDisabled: (this.wisnPoaService.getUserPermissionAction(&#x27;redistributionCost&#x27;) &#x3D;&#x3D;&#x3D; &#x27;CAN_VIEW&#x27;) ? true : false,
          value: 0,
          storedBy: &#x27;&#x27;,
          orgunitId: this.selectedOrgunit.id,
          period: this.period,
          index: index,
          program: this.costAssumptionProgram
        });
      });
      // console.log(JSON.stringify(this.getPermissionAction(&#x27;redistributionCost&#x27;)));
      this.maxBudgetHRHconstraintDataElements.forEach((dx: any, index) &#x3D;&gt; {
        this.analyticsDxCollection +&#x3D; &#x27;dimension&#x3D;&#x27; + dx.id + &#x27;&amp;&#x27;;
        maxBudgetHRHconstraintData.push({
          entityName: &#x27;maximumBudget&#x27;,
          cadreCode: fromUtilHelpers.getFuzzyMatchCadreCode(dx.name, this.cadreFromGeneralConfig),
          name: dx.displayFormName,
          dataElementId: dx.id,
          value: 0,
          isDisabled: ((dx.displayFormName.includes(&#x27;Total&#x27;)) ? false : true ||
          (this.wisnPoaService.getUserPermissionAction(&#x27;maximumBudget&#x27;) &#x3D;&#x3D;&#x3D; &#x27;CAN_VIEW&#x27;) ? true : false),
          storedBy: &#x27;&#x27;,
          orgunitId: this.selectedOrgunit.id,
          period: this.period,
          index: index,
          program: this.costAssumptionProgram
        });
      });
      this.maxNumberHRHconstraintDataElements.forEach((dx: any, index) &#x3D;&gt; {
        this.analyticsDxCollection +&#x3D; &#x27;dimension&#x3D;&#x27; + dx.id + &#x27;&amp;&#x27;;
        maxNumberHRHconstraintData.push({
          entityName: &#x27;maximumNumber&#x27;,
          cadreCode: fromUtilHelpers.getFuzzyMatchCadreCode(dx.name, this.cadreFromGeneralConfig),
          name: dx.displayFormName,
          dataElementId: dx.id,
          value: 0,
          isDisabled: (this.wisnPoaService.getUserPermissionAction(&#x27;maximumNumber&#x27;) &#x3D;&#x3D;&#x3D; &#x27;CAN_VIEW&#x27;) ? true : false,
          storedBy: &#x27;&#x27;,
          orgunitId: this.selectedOrgunit.id,
          period: this.period,
          index: index,
          program: this.costAssumptionProgram,
          isLocked: false
        });
      });
      this.allowanceCostDataElements.forEach((dx: any, index) &#x3D;&gt; {
        this.analyticsDxCollection +&#x3D; &#x27;dimension&#x3D;&#x27; + dx.id + &#x27;&amp;&#x27;;
        allowanceCostData.push({
          name: dx.displayFormName,
          dataElementId: dx.id,
          value: 0,
          storedBy: &#x27;&#x27;,
          orgunitId: this.selectedOrgunit.id,
          period: this.period,
          index: index,
          program: this.costAssumptionProgram
        });
      });
      this.monthlySalaryDataElements.forEach((dx: any, index) &#x3D;&gt; {
        this.analyticsDxCollection +&#x3D; &#x27;dimension&#x3D;&#x27; + dx.id + &#x27;&amp;&#x27;;
        monthlySalaryData.push({
          entityName: &#x27;salaryCost&#x27;,
          cadreCode: fromUtilHelpers.getFuzzyMatchCadreCode(dx.name, this.cadreFromGeneralConfig),
          name: dx.displayFormName,
          dataElementId: dx.id,
          value: 0,
          isDisabled: (this.wisnPoaService.getUserPermissionAction(&#x27;salaryCost&#x27;) &#x3D;&#x3D;&#x3D; &#x27;CAN_VIEW&#x27;) ? true : false,
          storedBy: &#x27;&#x27;,
          orgunitId: this.selectedOrgunit.id,
          period: this.period,
          index: index,
          program: this.costAssumptionProgram
        });
      });
      this.maxBudgetHRHconstraintData &#x3D; maxBudgetHRHconstraintData;
      this.maxNumberHRHconstraintData &#x3D; maxNumberHRHconstraintData;
      this.redistributionCostData &#x3D; redistributionCostData;
      this.allowanceCostData &#x3D; allowanceCostData;
      this.monthlySalaryData &#x3D; monthlySalaryData;
    }),
    switchMap(() &#x3D;&gt;
      this.wisnAnalyticsService.getLatestMultipleEventDataValues(
        [{ id: this.selectedOrgunit.id }],
        this.costAssumptionProgram.id
      )
    ),
    map((eventData: any) &#x3D;&gt; {
      if (eventData.events.length &gt; 0) {
        this.eventData &#x3D; eventData.events ? eventData.events[0] : [];
        this.redistributionCostData.forEach((redistCost: any) &#x3D;&gt; {
          this.eventData.dataValues.forEach((dataValue: any) &#x3D;&gt; {
            if (redistCost.dataElementId &#x3D;&#x3D;&#x3D; dataValue.dataElement) {
              redistCost.value &#x3D; dataValue.value
                ? parseFloat(dataValue.value)
                : 0;
              redistCost.storedBy &#x3D; dataValue.storedBy ? dataValue.storedBy : &#x27;&#x27;;
            }
          });
        });
        this.maxBudgetHRHconstraintData.forEach((budgetConstraint: any) &#x3D;&gt; {
          this.eventData.dataValues.forEach((dataValue: any) &#x3D;&gt; {
            if (budgetConstraint.dataElementId &#x3D;&#x3D;&#x3D; dataValue.dataElement) {
              budgetConstraint.value &#x3D; dataValue.value
                ? parseFloat(dataValue.value)
                : 0;
              budgetConstraint.storedBy &#x3D; dataValue.storedBy
                ? dataValue.storedBy
                : &#x27;&#x27;;
            }
          });
        });
        this.allowanceCostData.forEach((allowanceCost: any) &#x3D;&gt; {
          this.eventData.dataValues.forEach((dataValue: any) &#x3D;&gt; {
            if (allowanceCost.dataElementId &#x3D;&#x3D;&#x3D; dataValue.dataElement) {
              allowanceCost.value &#x3D; dataValue.value
                ? parseFloat(dataValue.value)
                : 0;
              allowanceCost.storedBy &#x3D; dataValue.storedBy
                ? dataValue.storedBy
                : &#x27;&#x27;;
            }
          });
        });
        this.monthlySalaryData.forEach((montlhyCost: any) &#x3D;&gt; {
          this.eventData.dataValues.forEach((dataValue: any) &#x3D;&gt; {
            if (montlhyCost.dataElementId &#x3D;&#x3D;&#x3D; dataValue.dataElement) {
              montlhyCost.value &#x3D; dataValue.value
                ? parseFloat(dataValue.value)
                : 0;
              montlhyCost.storedBy &#x3D; dataValue.storedBy ? dataValue.storedBy : &#x27;&#x27;;
            }
          });
        });
        this.maxNumberHRHconstraintData.forEach((maxNumberHRH: any) &#x3D;&gt; {
          this.eventData.dataValues.forEach((dataValue: any) &#x3D;&gt; {
            if (maxNumberHRH.dataElementId &#x3D;&#x3D;&#x3D; dataValue.dataElement) {
              maxNumberHRH.value &#x3D; dataValue.value
                ? parseFloat(dataValue.value)
                : 0;
              maxNumberHRH.storedBy &#x3D; dataValue.storedBy
                ? dataValue.storedBy
                : &#x27;&#x27;;
            }
          });
        });
        this.maxBudgetHRHconstraintData &#x3D; fromCostAssumptionsHelpers
        .reCalculateMaximumBudget(this.maxNumberHRHconstraintData,
          this.maxBudgetHRHconstraintData, this.monthlySalaryData);

      } else {
        const dataValues &#x3D; [];
        this.dataElements.forEach((costAssumptionDX: any) &#x3D;&gt; {
          dataValues.push({
            dataElement: costAssumptionDX.id,
            value: &#x27;&#x27;
          });
        });
        this.eventData &#x3D; {
            program: this.costAssumptionProgram.id,
            orgUnit: this.selectedOrgunit.id,
            eventDate: this.todayTimeDate,
            status: &#x27;COMPLETED&#x27;,
            storedBy: this.currentUser.userCredentials.username ?
              this.currentUser.userCredentials.username : &#x27;&#x27;,
            coordinate: {
            latitude: 0,
            longitude: 0},
            dataValues: dataValues
        };
      }
      const lastDataSelection &#x3D; {
        orgunit: this.selectedOrgunit.id,
        period: this.period.id
      };
      this.store.dispatch(
        new AddPoaCostAssumption({
          lastDataSelection: lastDataSelection,
          allowanceCostData: this.redistributionCostData,
          maximumBudget: this.maxBudgetHRHconstraintData,
          maximumNumber: this.maxNumberHRHconstraintData,
          remainingMaxBudget: fromCostAssumptionsHelpers.remainingMaxBudget(this.maxBudgetHRHconstraintData),
          progressLoader: 100,
          redistributionCostData: {
            period: this.allowanceCostData[0],
            salaryCost: this.allowanceCostData.slice(1)
          },
          monthlySalaryData: this.monthlySalaryData
        })
      );
      this.store.dispatch(new AddPoaCostAssumptionProgram(this.eventData));
      this.store.dispatch(new CheckingPoaPriState());
      //  this.store.dispatch(new CostAssumptionsLoadMaxHRHFromPRIlist());
    }),
    catchError(error &#x3D;&gt;
      of(this.store.dispatch(new POAcostAssumputionsErrorHandler(error)))
    ) // fire an action to indicate that load data has failed
  );

  @Effect({dispatch: false})
  updatingCostAssumptionProgramValues$ &#x3D; this.action$.pipe(
    ofType(PoaCostAssumptionActionTypes.UpdatingPoaCostAssumptionsProgram),
    withLatestFrom(this.store.select(getPoaPriEntitieState),
    this.store.select(getPoaCostAssumptionsMaxNumberState),
    this.store.select(getPoaCostAssumptionsMaxBudgetState),
    this.store.select(getPoaCostAssumptionsSalaryCostState)),
    map(
      (
        [action, priState, maxHRHdata, maxBudget, salaryData]:
        [fromPoaCostAssumptionActions.UpdatingPoaCostAssumptionsProgram, any, any, any, any]
      ) &#x3D;&gt; {
        // use another variable to avoid varialble reference
        const newMaxNumberHRHconstraintData &#x3D; (maxHRHdata || []).map(maxHRH &#x3D;&gt; Object.assign({}, maxHRH));
        const maxBudgetHRHconstraintData &#x3D; (maxBudget || []).map(budget &#x3D;&gt; Object.assign({}, budget));
        const monthlySalaryData &#x3D; (salaryData || []).map(salary &#x3D;&gt; Object.assign({}, salary));
        const priData &#x3D; (priState || []).map(pri &#x3D;&gt; Object.assign({}, pri));
        this.currentDomElementFieldUpdated &#x3D;
          action.payload.changedData.domElementId;
          // this code will handle scenarios when maximumNumber section is being edited
        if (action.payload.rowData.entityName &#x3D;&#x3D;&#x3D; &#x27;maximumNumber&#x27;) {
            // use another variable to avoid varialble reference
          const maximumHRH &#x3D; (maxHRHdata || []).map(maxHRH &#x3D;&gt; Object.assign({}, maxHRH));
          let backUpValueMaxHRH &#x3D; 0;
          const updatedMaxHRHTemp &#x3D; maximumHRH.map(maxHRH &#x3D;&gt; {
            if (maxHRH.cadreCode &#x3D;&#x3D;&#x3D; action.payload.rowData.cadreCode) {
              backUpValueMaxHRH &#x3D; maxHRH.value;
              maxHRH.isLocked &#x3D; true;
              maxHRH.value &#x3D; action.payload.changedData.value;
            }
            return maxHRH;
          });

          let updatedMaxBudgets &#x3D; fromCostAssumptionsHelpers
          .reCalculateMaximumBudget(updatedMaxHRHTemp,
            maxBudgetHRHconstraintData, monthlySalaryData);
           const remainingBudget &#x3D; fromCostAssumptionsHelpers.remainingMaxBudget(updatedMaxBudgets);
           const updatedMaxHRH &#x3D; fromCostAssumptionsHelpers
           .computeMaxHRHBasedOnRemaingBudget(remainingBudget, updatedMaxHRHTemp, monthlySalaryData, priData);
           updatedMaxBudgets &#x3D; fromCostAssumptionsHelpers
          .reCalculateMaximumBudget(updatedMaxHRH,
            maxBudgetHRHconstraintData, monthlySalaryData);

          const updatedTotalMaxBudgets &#x3D; fromCostAssumptionsHelpers.processTotalSalaryCost(updatedMaxBudgets);
          const totalMaxBudgetIndex &#x3D; maxBudgetHRHconstraintData
            .findIndex(budget &#x3D;&gt; budget.name.toLowerCase().indexOf(&#x27;total&#x27;) &gt; -1);
          const totalMaxBudgetValue &#x3D; maxBudgetHRHconstraintData[totalMaxBudgetIndex].value;
            if (updatedTotalMaxBudgets &gt; totalMaxBudgetValue) {
              alert(&#x27;Sorry, the value entered cant be accepted because it exceeded max number of HRH based on budget available&#x27;);
              action.payload.changedData.value &#x3D; backUpValueMaxHRH;
              this.store.dispatch(new UpsertPoaCostAssumption(action.payload)); // upserting the value to the store
              this.singleEventUpload &#x3D; {};
              this.currentDomElementFieldUpdated &#x3D; &#x27;&#x27;;
              try {
                document.getElementById(
                  action.payload.changedData.domElementId
                ).style.backgroundColor &#x3D; &#x27;white&#x27;;
              } catch (e) {}
            } else {
                // update all maxHRH values to maintain consistency on intial loading
              this.eventData.dataValues.forEach(dataValue &#x3D;&gt; {
                updatedMaxHRH.forEach(maxhrh &#x3D;&gt; {
                  if (dataValue.dataElement &#x3D;&#x3D;&#x3D; maxhrh.dataElementId) {
                    dataValue.value &#x3D; maxhrh.value;
                  }
                });
              });
              const currentCadre &#x3D; newMaxNumberHRHconstraintData.filter(maxHRH &#x3D;&gt; maxHRH.cadreCode &#x3D;&#x3D;&#x3D; action.payload.rowData.cadreCode);
        const newEventDataValuesFormat &#x3D; fromCostAssumptionsHelpers
        .generateCostAssumptionImportFormat(this.eventData, action, currentCadre[0].value ? currentCadre[0].value : 0);
              this.costAssumptionProgramEventDataValues &#x3D; newEventDataValuesFormat;
              this.singleEventUpload &#x3D; newEventDataValuesFormat;
              // update store with new changes
              this.store.dispatch(new CostAssumputionsMaxNumberHRH({
                maximumBudget: updatedMaxBudgets,
                maximumNumber: updatedMaxHRH,
                remainingMaxBudget: fromCostAssumptionsHelpers.remainingMaxBudget(updatedMaxBudgets),
              })); // upserting the value to the store
            }
        } else if (action.payload.rowData.entityName &#x3D;&#x3D;&#x3D; &#x27;salaryCost&#x27;) {
          let eventDataValuesFormat &#x3D; [];
          const newMonthlySalaryData &#x3D; monthlySalaryData.map(salary &#x3D;&gt; {
            if (salary.dataElementId &#x3D;&#x3D;&#x3D; action.payload.rowData.dataElementId) {
              salary.value &#x3D; action.payload.changedData.value;
            }
            return salary;
          });
          const updatedMaxHRH &#x3D; fromCostAssumptionsHelpers
          .calculateMaximumHRHfromPRI(maxBudgetHRHconstraintData,
            newMaxNumberHRHconstraintData, monthlySalaryData, priData);

        const updatedMaxBudgets &#x3D; fromCostAssumptionsHelpers
        .reCalculateMaximumBudget(newMaxNumberHRHconstraintData,
          maxBudgetHRHconstraintData, monthlySalaryData);
        const currentCadre &#x3D; newMaxNumberHRHconstraintData.filter(maxHRH &#x3D;&gt; maxHRH.cadreCode &#x3D;&#x3D;&#x3D; action.payload.rowData.cadreCode);
        if (currentCadre) {
         const currentData &#x3D; updatedMaxBudgets.filter(budget &#x3D;&gt; budget.name.toLowerCase().includes(&#x27;total&#x27;));
        eventDataValuesFormat &#x3D; fromCostAssumptionsHelpers
        .generateCostAssumptionImportFormat(this.eventData, action, currentData[0].value ? currentData[0].value : 0);
        } else {
          eventDataValuesFormat &#x3D; fromCostAssumptionsHelpers
          .generateCostAssumptionImportFormat(this.eventData, action, currentCadre[0].value ? currentCadre[0].value : 0);
        }
          this.costAssumptionProgramEventDataValues &#x3D; eventDataValuesFormat;
          this.singleEventUpload &#x3D; eventDataValuesFormat;
          this.store.dispatch(new CostAssumputionsSalaryCost({
            salaryCost: newMonthlySalaryData,
            maximumBudget: updatedMaxBudgets,
            maximumNumber: updatedMaxHRH,
            remainingMaxBudget: fromCostAssumptionsHelpers.remainingMaxBudget(updatedMaxBudgets),
          }));
        } else if (action.payload.rowData.entityName &#x3D;&#x3D;&#x3D; &#x27;maximumBudget&#x27;) {
          let updatedMaxBudgets &#x3D; maxBudgetHRHconstraintData.map(maxBudgetHRH &#x3D;&gt; {
            if (maxBudgetHRH.dataElementId &#x3D;&#x3D;&#x3D; action.payload.rowData.dataElementId) {
              maxBudgetHRH.value &#x3D; action.payload.changedData.value;
            }
            return maxBudgetHRH;
          });

          const updatedMaxHRH &#x3D; fromCostAssumptionsHelpers
          .calculateMaximumHRH(updatedMaxBudgets,
            newMaxNumberHRHconstraintData, monthlySalaryData);

          updatedMaxBudgets &#x3D; fromCostAssumptionsHelpers
        .reCalculateMaximumBudget(updatedMaxHRH,
          updatedMaxBudgets, monthlySalaryData);

          const currentData &#x3D; updatedMaxBudgets.filter(budget &#x3D;&gt; budget.name.toLowerCase().includes(&#x27;total&#x27;));
        const eventDataValuesFormat &#x3D; fromCostAssumptionsHelpers
        .generateCostAssumptionImportFormat(this.eventData, action, currentData[0].value ? currentData[0].value : 0);

          this.costAssumptionProgramEventDataValues &#x3D; eventDataValuesFormat;
          this.singleEventUpload &#x3D; eventDataValuesFormat;
          this.store.dispatch(new CostAssumputionsMaxNumberHRH({
            maximumBudget: updatedMaxBudgets,
            maximumNumber: updatedMaxHRH,
            remainingMaxBudget: fromCostAssumptionsHelpers.remainingMaxBudget(updatedMaxBudgets),
          })); // upserting the value to the store

          this.store.dispatch(new CostAssumptionsLoadMaxHRHFromPRIlist());
        } else if (action.payload.rowData.entityName &#x3D;&#x3D;&#x3D; &#x27;redistributionCost&#x27;) {
          this.eventData.dataValues.forEach(dataValue &#x3D;&gt; {
            if (dataValue.dataElement &#x3D;&#x3D;&#x3D; action.payload.changedData.dataElementId) {
              dataValue.value &#x3D; action.payload.changedData.value;
            }
          });
          this.store.dispatch(new UpsertPoaCostAssumption(action.payload)); // upserting the value to the store
          this.costAssumptionProgramEventDataValues &#x3D; this.eventData;
          this.singleEventUpload &#x3D; this.eventData;
        }
      }
    ),
    switchMap(() &#x3D;&gt;
      this.wisnAnalyticsService.updateSingleProgramDataValue(
        this.singleEventUpload
      )
    ),
    map((response: any) &#x3D;&gt; {
      try {
        document.getElementById(
          this.currentDomElementFieldUpdated
        ).style.backgroundColor &#x3D; &#x27;#b9ffb9&#x27;;
        document.getElementById(
          this.currentDomElementFieldUpdated
        ).style.borderColor &#x3D; &#x27;#dc3545&#x27;;
      } catch (e) {}
      return new AddPoaCostAssumptionProgram(
        this.costAssumptionProgramEventDataValues
      );
    }),
    catchError(
      error &#x3D;&gt;
        (document.getElementById(
          this.currentDomElementFieldUpdated
        ).style.backgroundColor &#x3D; &#x27;#ebd1d6&#x27;)
    )
  );

  // @Effect()

  @Effect()
  loadMaxHRHfromPRI &#x3D; this.action$.pipe(
    ofType(PoaCostAssumptionActionTypes.CostAssumptionsLoadMaxHRHFromPRIlist),
    withLatestFrom(this.store.select(getPoaCostAssumptionsMaxNumberState),
    this.store.select(getPoaCostAssumptionsMaxBudgetState),
    this.store.select(getPoaCostAssumptionsSalaryCostState),
    this.store.select(getPoaPriEntitieState)
    ),
    map(([action, maximumHRH , maximumBudget, salaryCosts, priList]:
      [fromPoaCostAssumptionActions.CostAssumptionsLoadMaxHRHFromPRIlist, any, any, any, any]) &#x3D;&gt; {
        // klskf
       const updatedMaxHRH &#x3D; fromCostAssumptionsHelpers
       .calculateMaximumHRHfromPRI(maximumBudget, maximumHRH, salaryCosts, priList);
       const updatedMaxBudgets &#x3D; fromCostAssumptionsHelpers
       .reCalculateMaximumBudget(updatedMaxHRH,
        maximumBudget, salaryCosts);
        return new CostAssumputionsMaxNumberHRH({
          maximumBudget: updatedMaxBudgets,
          maximumNumber: updatedMaxHRH,
          remainingMaxBudget: fromCostAssumptionsHelpers.remainingMaxBudget(updatedMaxBudgets),
        });
    })
  );
}



</code></pre>
    </div>

</div>











                   </div><div class="search-results">
    <div class="has-results">
        <h1 class="search-results-title"><span class='search-results-count'></span> result-matching "<span class='search-query'></span>"</h1>
        <ul class="search-results-list"></ul>
    </div>
    <div class="no-results">
        <h1 class="search-results-title">No results matching "<span class='search-query'></span>"</h1>
    </div>
</div>
</div>
               <!-- END CONTENT -->
           </div>
       </div>

       <script>
            var COMPODOC_CURRENT_PAGE_DEPTH = 1;
            var COMPODOC_CURRENT_PAGE_CONTEXT = 'injectable';
            var COMPODOC_CURRENT_PAGE_URL = 'PoaCostAssumptionEffect.html';
       </script>

       <script src="../js/libs/custom-elements.min.js"></script>
       <script src="../js/libs/lit-html.js"></script>
       <!-- Required to polyfill modern browsers as code is ES5 for IE... -->
       <script src="../js/libs/custom-elements-es5-adapter.js" charset="utf-8" defer></script>
       <script src="../js/menu-wc.js" defer></script>

       <script src="../js/libs/bootstrap-native.js"></script>

       <script src="../js/libs/es6-shim.min.js"></script>
       <script src="../js/libs/EventDispatcher.js"></script>
       <script src="../js/libs/promise.min.js"></script>
       <script src="../js/libs/zepto.min.js"></script>

       <script src="../js/compodoc.js"></script>

       <script src="../js/tabs.js"></script>
       <script src="../js/menu.js"></script>
       <script src="../js/libs/clipboard.min.js"></script>
       <script src="../js/libs/prism.js"></script>
       <script src="../js/sourceCode.js"></script>
          <script src="../js/search/search.js"></script>
          <script src="../js/search/lunr.min.js"></script>
          <script src="../js/search/search-lunr.js"></script>
          <script src="../js/search/search_index.js"></script>
       <script src="../js/lazy-load-graphs.js"></script>


    </body>
</html>
